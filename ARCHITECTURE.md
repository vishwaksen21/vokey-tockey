# ğŸ¯ Vokey-Tockey - Technical Architecture

## System Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER JOURNEY                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User 1                                                    User 2
    â”‚                                                          â”‚
    â”‚  1. Opens app                                           â”‚
    â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚ Landing Pageâ”‚                                               â”‚
â”‚  - Enter ID â”‚                                               â”‚
â”‚  - OR       â”‚                                               â”‚
â”‚  - Create   â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
       â”‚ Clicks "Create Room"                                 â”‚
       â”‚ Generated: vokey-abc123                              â”‚
       â”‚                                                      â”‚
       â–¼                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  Room Page   â”‚                                              â”‚
â”‚  /room/      â”‚                                              â”‚
â”‚  vokey-abc123â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          User 2 joins same room             â”‚
       â”‚                  by entering "vokey-abc123"          â”‚
       â”‚                                                      â”‚
       â–¼                                                      â–¼
   Request Mic                                           Request Mic
   Permission                                            Permission
       â”‚                                                      â”‚
       â–¼                                                      â–¼
   Connect to                                            Connect to
   WebSocket                                             WebSocket
       â”‚                                                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   WebSocket Signaling Exchange      â”‚
        â”‚  (Offers, Answers, ICE Candidates)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  WebRTC Peer Connection      â”‚
           â”‚  Established (P2P Audio)     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 ğŸ™ï¸ Voice Chat Active!


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENT ARCHITECTURE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FRONTEND (React)                    BACKEND (FastAPI)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LandingPage   â”‚
â”‚                 â”‚
â”‚  - Room input   â”‚
â”‚  - Create btn   â”‚
â”‚  - Join btn     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ navigate()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RoomPage                â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚         â”‚   FastAPI App    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚                  â”‚
â”‚  â”‚  useRoomWebSocket()       â”‚â—„â”¼â”€â”€â”€â”€WSâ”€â”€â”€â”¤  /ws/rooms/:id   â”‚
â”‚  â”‚  - Connect to WS          â”‚ â”‚         â”‚                  â”‚
â”‚  â”‚  - Send/receive signals   â”‚ â”‚         â”‚  - Room state    â”‚
â”‚  â”‚  - Handle reconnect       â”‚ â”‚         â”‚  - Broadcast     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  - Relay signals â”‚
â”‚             â”‚                   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚                   â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                 â”‚
â”‚  â”‚  useWebRTC()              â”‚ â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  - Create peer conns     â”‚ â”‚         â”‚  Data Structures â”‚
â”‚  â”‚  - Handle local stream   â”‚ â”‚         â”‚                  â”‚
â”‚  â”‚  - Handle remote streams â”‚ â”‚         â”‚  rooms: {}       â”‚
â”‚  â”‚  - Send offers/answers   â”‚ â”‚         â”‚  client_info: {} â”‚
â”‚  â”‚  - Exchange ICE          â”‚ â”‚         â”‚  client_ids: {}  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   UI Components           â”‚ â”‚
â”‚  â”‚  - MicButton              â”‚ â”‚
â”‚  â”‚  - ParticipantCard        â”‚ â”‚
â”‚  â”‚  - SpeakingIndicator      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE FLOW (WebSocket)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client A                     Server                      Client B
   â”‚                           â”‚                            â”‚
   â”‚â”€â”€â”€â”€ connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
   â”‚                           â”‚                            â”‚
   â”‚â—„â”€â”€â”€ join msg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
   â”‚  { type: "join",          â”‚                            â”‚
   â”‚    clientId: "uuid-A" }   â”‚                            â”‚
   â”‚                           â”‚                            â”‚
   â”‚                           â”‚â—„â”€â”€â”€â”€â”€ connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                           â”‚                            â”‚
   â”‚â—„â”€ new-peer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€ new-peer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚  { type: "new-peer",      â”‚  { type: "new-peer",       â”‚
   â”‚    clientId: "uuid-B" }   â”‚    clientId: "uuid-A" }    â”‚
   â”‚                           â”‚                            â”‚
   â”‚â”€â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
   â”‚  { type: "offer",         â”‚                            â”‚
   â”‚    to: "uuid-B",          â”‚                            â”‚
   â”‚    payload: { sdp } }     â”‚â”€â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                            â”‚
   â”‚                           â”‚â—„â”€â”€â”€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—„â”€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
   â”‚                           â”‚                            â”‚
   â”‚â”€â”€â”€â”€ ICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”€â”€â”€â”€ ICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                            â”‚
   â”‚â—„â”€â”€â”€â”€ ICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€ ICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                           â”‚                            â”‚
   â””â”€ WebRTC P2P Audio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  WebRTC CONNECTION FLOW                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Peer A (Caller)                              Peer B (Callee)
      â”‚                                            â”‚
      â”‚ 1. Create RTCPeerConnection                â”‚
      â”‚    with STUN servers                       â”‚
      â–¼                                            â”‚
 Add local audio track                            â”‚
      â”‚                                            â”‚
      â”‚ 2. Create Offer                            â”‚
      â–¼                                            â”‚
 Set local description (offer)                     â”‚
      â”‚                                            â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€ Send Offer (via WS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                                            â”‚
      â”‚                                  3. Create RTCPeerConnection
      â”‚                                            â”‚
      â”‚                                  Add local audio track
      â”‚                                            â”‚
      â”‚                                  Set remote description (offer)
      â”‚                                            â”‚
      â”‚                                  4. Create Answer
      â”‚                                            â”‚
      â”‚                                  Set local description (answer)
      â”‚                                            â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€ Send Answer (via WS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                                            â”‚
 5. Set remote description (answer)                â”‚
      â”‚                                            â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ Exchange ICE Candidates â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚          (both directions)                 â”‚
      â”‚                                            â”‚
      â–¼                                            â–¼
 ICE Connection: new â†’ checking â†’ connected
      â”‚                                            â”‚
      â”‚                                            â”‚
      â–¼                                            â–¼
 ontrack event fires â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ontrack event fires
 (receive remote stream)                    (receive remote stream)
      â”‚                                            â”‚
      â”‚                                            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€ Direct Audio Stream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              (Peer-to-Peer, no server)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STATE MANAGEMENT                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RoomPage Component State:
â”œâ”€â”€ signalingSocket (from useRoomWebSocket)
â”‚   â”œâ”€â”€ socket: WebSocket
â”‚   â”œâ”€â”€ clientId: string
â”‚   â”œâ”€â”€ isConnected: boolean
â”‚   â”œâ”€â”€ connectionStatus: string
â”‚   â”œâ”€â”€ otherPeers: string[]
â”‚   â””â”€â”€ methods: sendMessage(), onMessage(), disconnect()
â”‚
â””â”€â”€ webRTC (from useWebRTC)
    â”œâ”€â”€ localStream: MediaStream
    â”œâ”€â”€ peers: { [peerId]: { connection, stream, isSpeaking } }
    â”œâ”€â”€ isMuted: boolean
    â”œâ”€â”€ micPermissionGranted: boolean
    â””â”€â”€ methods: toggleMute(), initializeMicrophone()


Server State (Backend):
â”œâ”€â”€ rooms: { [roomId]: Set<WebSocket> }
â”œâ”€â”€ client_info: { WebSocket: { clientId, roomId } }
â””â”€â”€ client_ids: { [roomId]: { [clientId]: WebSocket } }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA FLOW                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Audio Capture:
getUserMedia() â†’ MediaStream â†’ RTCPeerConnection.addTrack()
                                         â”‚
                                         â–¼
                              Sent via WebRTC (P2P)
                                         â”‚
                                         â–¼
                   Peer's RTCPeerConnection.ontrack
                                         â”‚
                                         â–¼
                                  MediaStream
                                         â”‚
                                         â–¼
                                  Audio Element
                                         â”‚
                                         â–¼
                                   Speaker ğŸ”Š


Speaking Detection:
MediaStream â†’ AudioContext â†’ AnalyserNode â†’ getByteFrequencyData()
                                                      â”‚
                                                      â–¼
                                          Calculate average volume
                                                      â”‚
                                                      â–¼
                                          Update visual indicator


Signaling:
WebSocket Message â†’ useRoomWebSocket â†’ messageHandlers â†’ useWebRTC
                                                             â”‚
                                                             â–¼
                                                    RTCPeerConnection
                                                     (offer/answer/ICE)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERROR HANDLING FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Connection Errors:
WebSocket.onerror â†’ Update connectionStatus â†’ Show error UI
                                                      â”‚
                                                      â–¼
                                          Attempt reconnection
                                          (exponential backoff)

Microphone Errors:
getUserMedia() error â†’ Check error.name â†’ Display specific message
                                                      â”‚
                                                      â–¼
                                          - NotAllowedError: Permission denied
                                          - NotFoundError: No mic found
                                          - Other: Generic error

WebRTC Errors:
RTCPeerConnection.oniceconnectionstatechange â†’ Monitor state
                                                      â”‚
                                                      â–¼
                                          failed/disconnected
                                                      â”‚
                                                      â–¼
                                          Log error, retry connection


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CORS Protection (Backend)
   â”œâ”€â”€ Allowed origins whitelist
   â””â”€â”€ Credential validation

2. Input Validation
   â”œâ”€â”€ Room ID format validation (regex)
   â””â”€â”€ Message type validation

3. Rate Limiting (Optional)
   â””â”€â”€ Per-IP connection limits

4. Room Limits
   â””â”€â”€ Max 20 users per room

5. Connection Cleanup
   â”œâ”€â”€ Auto-remove dead connections
   â””â”€â”€ Graceful shutdown handling

6. HTTPS/WSS (Production)
   â”œâ”€â”€ Required for WebRTC
   â””â”€â”€ Encrypted WebSocket


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERFORMANCE OPTIMIZATIONS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend:
â”œâ”€â”€ React.memo() for components
â”œâ”€â”€ useCallback() for event handlers
â”œâ”€â”€ useRef() for mutable values (avoid re-renders)
â”œâ”€â”€ Lazy loading with React.lazy()
â””â”€â”€ Code splitting with Vite

Backend:
â”œâ”€â”€ Async/await for non-blocking I/O
â”œâ”€â”€ In-memory state (fast access)
â”œâ”€â”€ Efficient WebSocket broadcasting
â””â”€â”€ Connection pooling

WebRTC:
â”œâ”€â”€ P2P audio (no server bandwidth)
â”œâ”€â”€ Audio constraints (echo cancellation, noise suppression)
â””â”€â”€ STUN servers for NAT traversal


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCALING CONSIDERATIONS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Current: In-Memory State (Single Server)
â”œâ”€â”€ Pros: Fast, simple
â””â”€â”€ Cons: Lost on restart, no horizontal scaling

For Production Scale:
â”œâ”€â”€ Redis for distributed state
â”œâ”€â”€ Message queue (Redis Pub/Sub)
â”œâ”€â”€ Load balancer with sticky sessions
â””â”€â”€ Multiple backend instances

Room Size Limits:
â”œâ”€â”€ Mesh topology: 6-10 users max (current)
â”œâ”€â”€ SFU topology: 20-50 users (requires server)
â””â”€â”€ MCU topology: 100+ users (complex server)
```

## Key Takeaways

1. **WebSocket** = Signaling only (not for audio)
2. **WebRTC** = Actual audio P2P connection
3. **Server** = Matchmaker/coordinator, not audio relay
4. **Security** = HTTPS required in production
5. **Scaling** = Mesh works for small rooms, need SFU for larger

---

**See Also:**
- [README.md](./README.md) - Project overview
- [DEVELOPMENT.md](./DEVELOPMENT.md) - Development guide
- [DEPLOYMENT.md](./DEPLOYMENT.md) - Deployment guide
